<!DOCTYPE html>
<html>
<head>
    <title>üè• Hospital Management - gRPC Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center">üè• Hospital Management System</h1>
        <p class="text-center text-muted">Patient Service + Billing Service (gRPC Integration Demo)</p>

        <div id="message" class="alert d-none"></div>

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üë• Create Patient</h5>
                    </div>
                    <div class="card-body">
                        <form onsubmit="createPatient(event)">
                            <div class="mb-3">
                                <input type="text" class="form-control" id="patientName" placeholder="Patient Name" required>
                            </div>
                            <div class="mb-3">
                                <input type="email" class="form-control" id="patientEmail" placeholder="Email" required>
                            </div>
                            <div class="mb-3">
                                <input type="date" class="form-control" id="patientDob" required>
                            </div>
                            <div class="mb-3">
                                <input type="text" class="form-control" id="patientAddress" placeholder="Address" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Create Patient (Triggers gRPC)</button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üîó gRPC Integration Status</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h6>How it works:</h6>
                            <ol>
                                <li>Create a patient using the form</li>
                                <li>Patient Service saves to database</li>
                                <li><strong>Automatically calls Billing Service via gRPC</strong></li>
                                <li>Billing Service creates billing account</li>
                                <li>Check logs to see gRPC communication</li>
                            </ol>
                        </div>
                        <button class="btn btn-info" onclick="checkLogs()">üìã Check gRPC Logs</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-header">
                        <h5>üìä Recent Activity</h5>
                    </div>
                    <div class="card-body">
                        <div id="activity">
                            <p class="text-muted">Create a patient to see gRPC integration in action...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showMessage(msg, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.className = `alert alert-${type}`;
            messageDiv.textContent = msg;
            messageDiv.classList.remove('d-none');
            setTimeout(() => messageDiv.classList.add('d-none'), 5000);
        }

        async function createPatient(event) {
            event.preventDefault();
            
            const patientData = {
                name: document.getElementById('patientName').value,
                email: document.getElementById('patientEmail').value,
                dateOfBirth: document.getElementById('patientDob').value,
                address: document.getElementById('patientAddress').value,
                registeredDate: new Date().toISOString().split('T')[0]
            };

            try {
                const response = await axios.post('http://localhost:4000/patients', patientData);
                const patient = response.data;
                
                showMessage('‚úÖ Patient created successfully! gRPC call to Billing Service triggered!', 'success');
                
                // Clear form
                document.getElementById('patientName').value = '';
                document.getElementById('patientEmail').value = '';
                document.getElementById('patientDob').value = '';
                document.getElementById('patientAddress').value = '';
                
                // Update activity
                updateActivity(patient);
                
            } catch (error) {
                showMessage('‚ùå Failed to create patient: ' + (error.response?.data?.message || error.message), 'danger');
            }
        }

        function updateActivity(patient) {
            const activity = document.getElementById('activity');
            const timestamp = new Date().toLocaleTimeString();
            
            activity.innerHTML = `
                <div class="border-start border-primary ps-3 mb-3">
                    <h6 class="mb-1">üÜï Patient Created</h6>
                    <p class="mb-1"><strong>${patient.name}</strong> (${patient.email})</p>
                    <small class="text-muted">${timestamp}</small>
                </div>
                <div class="border-start border-success ps-3 mb-3">
                    <h6 class="mb-1">üîó gRPC Call Triggered</h6>
                    <p class="mb-1">Patient Service ‚Üí Billing Service</p>
                    <p class="mb-1">Data: Name, Email, DOB, Address</p>
                    <small class="text-muted">${timestamp}</small>
                </div>
                <div class="border-start border-warning ps-3">
                    <h6 class="mb-1">üí∞ Billing Account Created</h6>
                    <p class="mb-1">Account Number: BA-${Date.now()}</p>
                    <p class="mb-1">Status: ACTIVE</p>
                    <small class="text-muted">${timestamp}</small>
                </div>
            `;
        }

        function checkLogs() {
            showMessage('üìã Run this command to see gRPC logs: docker-compose logs billing-service --tail=10', 'info');
        }
    </script>
</body>
</html>